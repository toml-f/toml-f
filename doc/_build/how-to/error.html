

<!DOCTYPE html>


<html lang="en" data-content_root="" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Reporting errors &#8212; TOML Fortran</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=14f4ca6b54d191a8c7657f6c759bf11a5fb86285" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/custom.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=5a5c038af52cf7bc1a1ec88eea08e6366ee68824"></script>
    <script src="../_static/design-tabs.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'how-to/error';</script>
    <link rel="icon" href="../_static/toml-f.svg"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Date time compatibility" href="datetime.html" />
    <link rel="prev" title="Working with arrays" href="array.html" /> 
<meta
  name="description"
  content="TOML parser implementation for data serialization and deserialization in Fortran"
/>
<meta
  name="keywords"
  content="TOML parser, TOML, serde, Fortran library, Fortran package manager"
/>   
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search..."
         aria-label="Search..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/toml-f.svg" class="logo__image only-light" alt="TOML Fortran - Home"/>
    <img src="../_static/toml-f.svg" class="logo__image only-dark pst-js-only" alt="TOML Fortran - Home"/>
  
  
</a></div>
        <div class="sidebar-primary-item"><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        <ul class="current nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../tutorial/index.html">Tutorials</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/getting-started.html">Getting started</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/namelist-to-toml.html">Converting from Namelist to TOML</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/fpm-lint.html">Building a linter</a></li>
<li class="toctree-l2"><a class="reference internal" href="../tutorial/json.html">Writing a custom lexer</a></li>
</ul>
</details></li>
<li class="toctree-l1 current active has-children"><a class="reference internal" href="index.html">How-Tos</a><details open="open"><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="installation.html">Installing TOML Fortran</a></li>
<li class="toctree-l2"><a class="reference internal" href="integration.html">Using TOML Fortran</a></li>
<li class="toctree-l2"><a class="reference internal" href="table.html">Working with tables</a></li>
<li class="toctree-l2"><a class="reference internal" href="array.html">Working with arrays</a></li>
<li class="toctree-l2 current active"><a class="current reference internal" href="#">Reporting errors</a></li>
<li class="toctree-l2"><a class="reference internal" href="datetime.html">Date time compatibility</a></li>
<li class="toctree-l2"><a class="reference internal" href="serde.html">Serializable base class</a></li>
<li class="toctree-l2"><a class="reference internal" href="jonquil.html">Compatibility with JSON</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../reference/index.html">References</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference external" href="https://toml.io/en/v1.0.0">TOML specification</a></li>
<li class="toctree-l2"><a class="reference external" href="https://toml-f.github.io/toml-f">API documentation</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../news/index.html">News</a></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../external.html">External resources</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference external" href="https://cyber.dabamos.de/programming/modernfortran/toml.html">Modern Fortran by Philipp Engel (English)</a></li>
<li class="toctree-l2"><a class="reference external" href="https://fortran-fans.github.io/Fortran-in-Action/Using-Open-Source-Code/Project-Configuration-TOML-F.html">Fortran in Action by Zuo Zhihua (Chinese)</a></li>
</ul>
</details></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><label class="sidebar-toggle primary-toggle btn btn-sm" for="__primary" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</label></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/toml-f/toml-f" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/toml-f/toml-f/edit/main/doc/how-to/error.rst" target="_blank"
   class="btn btn-sm btn-source-edit-button dropdown-item"
   title="Suggest edit"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="btn__text-container">Suggest edit</span>
</a>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<label class="sidebar-toggle secondary-toggle btn btn-sm" for="__secondary"title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</label>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Reporting errors</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-with-rich-context">Loading with rich context</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiline-reports">Multiline reports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#color-support">Color support</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                   <section id="reporting-errors">
<h1>Reporting errors<a class="headerlink" href="#reporting-errors" title="Permalink to this heading">#</a></h1>
<p>TOML data structures can record their origin in the original TOML document, which can be used to report errors with rich context information.
The recipes here describe how to obtain the context for producing error messages and diagnostics using the origin information of the data structures.</p>
<section id="loading-with-rich-context">
<h2>Loading with rich context<a class="headerlink" href="#loading-with-rich-context" title="Permalink to this heading">#</a></h2>
<p>To make use of the origin information, the context from loading the document has to be preserved.
This can be archived by passing the optional <code class="docutils literal notranslate"><span class="pre">context</span></code> argument to the loading interface to request the document context to be exported.
To obtain the context object we have to request it when reading the TOML document.</p>
<div class="literal-block-wrapper docutils container" id="id1">
<div class="code-block-caption"><span class="caption-text">app/main.f90</span><a class="headerlink" href="#id1" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">toml_load</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
</div>
<p>We define a simple data type for a configuration for this recipe.</p>
<div class="literal-block-wrapper docutils container" id="id2">
<div class="code-block-caption"><span class="caption-text">src/config.f90</span><a class="headerlink" href="#id2" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c">!&gt; Configuration data</span>
<span class="w">  </span><span class="k">type</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">config_type</span>
<span class="w">    </span><span class="c">!&gt; Time step for simulation</span>
<span class="w">    </span><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">timestep</span>
<span class="w">  </span><span class="k">end type </span><span class="n">config_type</span>
</pre></div>
</div>
</div>
<p>To report errors, we now not only use the TOML data structure, but also a context object, which allows us to create the report.</p>
<div class="literal-block-wrapper docutils container" id="id3">
<div class="code-block-caption"><span class="caption-text">src/config.f90</span><a class="headerlink" href="#id3" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c">!&gt; Load configuration data from TOML data structure</span>
<span class="w">  </span><span class="k">subroutine </span><span class="n">load_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="c">!&gt; Instance of the configuration data</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">config_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">config</span>
<span class="w">    </span><span class="c">!&gt; TOML data structure</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="c">!&gt; Context for reporting errors</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="nb">stat</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span>

<span class="w">    </span><span class="k">call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;timestep&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">%</span><span class="n">timestep</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="nb">stat</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">stat</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Cannot read timestep&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;expected real value&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">  end subroutine </span><span class="n">load_config</span>
</pre></div>
</div>
</div>
<p>To provide the data structure we create a simple driver to read a TOML document.</p>
<div class="literal-block-wrapper docutils container" id="id4">
<div class="code-block-caption"><span class="caption-text">app/main.f90</span><a class="headerlink" href="#id4" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">program </span><span class="n">demo</span>
<span class="w">  </span><span class="k">use </span><span class="n">tomlf</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">toml_table</span><span class="p">,</span><span class="w"> </span><span class="n">toml_error</span><span class="p">,</span><span class="w"> </span><span class="n">toml_context</span><span class="p">,</span><span class="w"> </span><span class="n">toml_load</span>
<span class="w">  </span><span class="k">use </span><span class="n">demo_config</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">config_type</span><span class="p">,</span><span class="w"> </span><span class="n">load_config</span>
<span class="w">  </span><span class="k">implicit none</span>

<span class="k">  type</span><span class="p">(</span><span class="n">config_type</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">config</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arg</span>

<span class="w">  </span><span class="k">call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span>

<span class="w">  </span><span class="k">block</span>
<span class="k">    type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_error</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">error</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="k">call </span><span class="n">toml_load</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span><span class="w"> </span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">error</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">%</span><span class="n">message</span>
<span class="w">      </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    call </span><span class="n">load_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">  </span><span class="k">end block</span>
<span class="k">end program </span><span class="n">demo</span>
</pre></div>
</div>
</div>
<p>Now we can try with an incorrect configuration file, where we pass a string instead of a float to our option.</p>
<div class="literal-block-wrapper docutils container" id="id5">
<div class="code-block-caption"><span class="caption-text">config.toml</span><a class="headerlink" href="#id5" title="Permalink to this code">#</a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">timestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;large&quot;</span>
</pre></div>
</div>
</div>
<p>The error message is produced and shows the exact origin of the value in the document.</p>
<pre class="ansi-block highlight literal-block">error: Cannot read timestep
 --&gt; config.toml:1:12-18
  |
1 | timestep = &quot;large&quot;
  |            ^^^^^^^ expected real value
  |</pre>
<p>Now we also have to handle the case where the value can be read correctly, but is incorrect for our application, like a negative timestep.</p>
<div class="literal-block-wrapper docutils container" id="id6">
<div class="code-block-caption"><span class="caption-text">src/config.f90</span><a class="headerlink" href="#id6" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">%</span><span class="n">timestep</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Timestep must be positive&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;expected positive value&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>
</pre></div>
</div>
</div>
<p>The origin information will still be available and allow us to make a rich report about the error in the input.</p>
<div class="literal-block-wrapper docutils container" id="id7">
<div class="code-block-caption"><span class="caption-text">config.toml</span><a class="headerlink" href="#id7" title="Permalink to this code">#</a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">timestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">-0.1</span>
</pre></div>
</div>
</div>
<p>The resulting error message is shown below.</p>
<pre class="ansi-block highlight literal-block">error: Timestep must be positive
 --&gt; fpm.toml:1:12-15
  |
1 | timestep = -0.1
  |            ^^^^ expected positive real value
  |</pre>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Each TOML data structure has an <em>origin</em> attribute, which can be used together with the report function of the context.
In case the origin cannot be mapped to a single token, <em>e.g.</em> for the root table, the value of the origin will be zero.
The report function will only produce labels for non-zero origins and gracefully ignore data without origin in the current context.</p>
</div>
<p>The reporting function is not limited to errors, it can also produce warnings or informational messages.
For this purpose, we select the appropriate <code class="docutils literal notranslate"><span class="pre">toml_level</span></code> for the report.</p>
<div class="literal-block-wrapper docutils container" id="id8">
<div class="code-block-caption"><span class="caption-text">src/config.f90</span><a class="headerlink" href="#id8" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">%</span><span class="n">timestep</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">large_timestep</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Large timesteps can lead to instable simulations&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="n">toml_level</span><span class="p">%</span><span class="n">warning</span><span class="p">)</span>
<span class="w">    </span><span class="k">end if</span>
</pre></div>
</div>
</div>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>The <code class="docutils literal notranslate"><span class="pre">toml_level</span></code> parameter provides a statically initialized derived type enumerating all available report levels.
You can think of it as an enumerator with a proper namespace.</p>
</div>
<p>We can test this for the following example.</p>
<div class="literal-block-wrapper docutils container" id="id9">
<div class="code-block-caption"><span class="caption-text">config.toml</span><a class="headerlink" href="#id9" title="Permalink to this code">#</a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="n">timestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mf">100.0</span>
</pre></div>
</div>
</div>
<p>The resulting warning is shown below.</p>
<pre class="ansi-block highlight literal-block">warning: Large timesteps can lead to instable simulations
 --&gt; config.toml:1:12-16
  |
1 | timestep = 100.0
  |            ^^^^^
  |</pre>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">full source</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The full <em>demo_config</em> module is given here.</p>
<div class="literal-block-wrapper docutils container" id="id10">
<div class="code-block-caption"><span class="caption-text">src/dependency.f90</span><a class="headerlink" href="#id10" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">!&gt; Module for reading in configuration data</span>
<span class="k">module </span><span class="n">demo_config</span>
<span class="w">  </span><span class="k">use </span><span class="n">tomlf</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">toml_table</span><span class="p">,</span><span class="w"> </span><span class="n">toml_context</span><span class="p">,</span><span class="w"> </span><span class="n">toml_level</span><span class="p">,</span><span class="w"> </span><span class="n">get_value</span>
<span class="w">  </span><span class="k">implicit none</span>

<span class="w">  </span><span class="c">!&gt; Configuration data</span>
<span class="w">  </span><span class="k">type</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">config_type</span>
<span class="w">    </span><span class="c">!&gt; Time step for simulation</span>
<span class="w">    </span><span class="kt">real</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">timestep</span>
<span class="w">  </span><span class="k">end type </span><span class="n">config_type</span>

<span class="w">  </span><span class="c">!&gt; Threshold for warning on large time step</span>
<span class="w">  </span><span class="kt">real</span><span class="p">,</span><span class="w"> </span><span class="k">parameter</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">large_timestep</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="mf">0.0</span>

<span class="k">contains</span>

<span class="w">  </span><span class="c">!&gt; Load configuration data from TOML data structure</span>
<span class="w">  </span><span class="k">subroutine </span><span class="n">load_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="c">!&gt; Instance of the configuration data</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">config_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">config</span>
<span class="w">    </span><span class="c">!&gt; TOML data structure</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="c">!&gt; Context for reporting errors</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="nb">stat</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span>

<span class="w">    </span><span class="k">call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;timestep&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="p">%</span><span class="n">timestep</span><span class="p">,</span><span class="w"> </span><span class="mf">0.5</span><span class="p">,</span><span class="w"> </span><span class="nb">stat</span><span class="o">=</span><span class="nb">stat</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">stat</span><span class="w"> </span><span class="o">/=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Cannot read timestep&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;expected real value&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">%</span><span class="n">timestep</span><span class="w"> </span><span class="o">&lt;=</span><span class="w"> </span><span class="mi">0</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Timestep must be positive&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;expected positive value&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    if</span><span class="w"> </span><span class="p">(</span><span class="n">config</span><span class="p">%</span><span class="n">timestep</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="n">large_timestep</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Large timesteps can lead to instable simulations&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">        </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">level</span><span class="o">=</span><span class="n">toml_level</span><span class="p">%</span><span class="n">warning</span><span class="p">)</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">  end subroutine </span><span class="n">load_config</span>

<span class="k">end module </span><span class="n">demo_config</span>
</pre></div>
</div>
</div>
<p class="sd-card-text">The driver for running the examples is given below.</p>
<div class="literal-block-wrapper docutils container" id="id11">
<div class="code-block-caption"><span class="caption-text">app/main.f90</span><a class="headerlink" href="#id11" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">program </span><span class="n">demo</span>
<span class="w">  </span><span class="k">use </span><span class="n">tomlf</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">toml_table</span><span class="p">,</span><span class="w"> </span><span class="n">toml_error</span><span class="p">,</span><span class="w"> </span><span class="n">toml_context</span><span class="p">,</span><span class="w"> </span><span class="n">toml_load</span>
<span class="w">  </span><span class="k">use </span><span class="n">demo_config</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">config_type</span><span class="p">,</span><span class="w"> </span><span class="n">load_config</span>
<span class="w">  </span><span class="k">implicit none</span>

<span class="k">  type</span><span class="p">(</span><span class="n">config_type</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">config</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arg</span>

<span class="w">  </span><span class="k">call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span>

<span class="w">  </span><span class="k">block</span>
<span class="k">    type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_error</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">error</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="k">call </span><span class="n">toml_load</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span><span class="w"> </span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">error</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">%</span><span class="n">message</span>
<span class="w">      </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    call </span><span class="n">load_config</span><span class="p">(</span><span class="n">config</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">  </span><span class="k">end block</span>
<span class="k">end program </span><span class="n">demo</span>
</pre></div>
</div>
</div>
</div>
</details></section>
<section id="multiline-reports">
<h2>Multiline reports<a class="headerlink" href="#multiline-reports" title="Permalink to this heading">#</a></h2>
<p>In some cases, multiple labels are required to express the context of the report correctly.
This feature is available with the context object, by providing the origin of the two data structures in the reporting function.</p>
<p>An example of this is the dependency table in fpm, where we can either provide a local dependency using the <em>path</em> key or a remote dependency using the <em>git</em> key, but not both at the same time.</p>
<p>We declare a simple dummy dependency storing only the dependency name for demonstration purposes.</p>
<div class="literal-block-wrapper docutils container" id="id12">
<div class="code-block-caption"><span class="caption-text">src/dependency.f90</span><a class="headerlink" href="#id12" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c">!&gt; Dummy dependency type storing only the name of the dependency</span>
<span class="w">  </span><span class="k">type</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dependency_type</span>
<span class="w">    </span><span class="c">!&gt; The name of the dependency</span>
<span class="w">    </span><span class="kt">character</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">name</span>
<span class="w">  </span><span class="k">end type </span><span class="n">dependency_type</span>
</pre></div>
</div>
</div>
<p>We iterate over the list of all subtables in the dependency table and read the actual dependency.
In case an entry is not a subtable we will raise an error, since a package manifest can contain multiple dependency tables, we will report which table we are currently in as additional context.</p>
<div class="literal-block-wrapper docutils container" id="id13">
<div class="code-block-caption"><span class="caption-text">src/dependency.f90</span><a class="headerlink" href="#id13" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c">!&gt; Load a list of dependencies from a table</span>
<span class="w">  </span><span class="k">subroutine </span><span class="n">load_dependencies</span><span class="p">(</span><span class="n">dependencies</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="c">!&gt; List of dependencies</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">dependency_type</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dependencies</span><span class="p">(:)</span>
<span class="w">    </span><span class="c">!&gt; TOML data structure</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="c">!&gt; Context for error messages</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_key</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">list</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">pointer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">child</span>

<span class="w">    </span><span class="k">call </span><span class="n">table</span><span class="p">%</span><span class="n">get_keys</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="n">dependencies</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">list</span><span class="p">)))</span>

<span class="w">    </span><span class="k">do </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="w">      </span><span class="k">call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">it</span><span class="p">),</span><span class="w"> </span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">associated</span><span class="p">(</span><span class="n">child</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">        print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;All entries must be subtables&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">%</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;must be a subtable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;required for this table&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">      </span><span class="k">end if</span>
<span class="k">      call </span><span class="n">load_dependency</span><span class="p">(</span><span class="n">dependencies</span><span class="p">(</span><span class="n">it</span><span class="p">),</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">it</span><span class="p">),</span><span class="w"> </span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="k">end do</span>
<span class="k">  end subroutine </span><span class="n">load_dependencies</span>
</pre></div>
</div>
</div>
<p>To provide the <em>dependencies</em> table we create a simple driver to read a TOML document.</p>
<div class="literal-block-wrapper docutils container" id="id14">
<div class="code-block-caption"><span class="caption-text">app/main.f90</span><a class="headerlink" href="#id14" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">program </span><span class="n">demo</span>
<span class="w">  </span><span class="k">use </span><span class="n">tomlf</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">toml_table</span><span class="p">,</span><span class="w"> </span><span class="n">toml_error</span><span class="p">,</span><span class="w"> </span><span class="n">toml_context</span><span class="p">,</span><span class="w"> </span><span class="n">toml_load</span><span class="p">,</span><span class="w"> </span><span class="n">get_value</span>
<span class="w">  </span><span class="k">use </span><span class="n">demo_dependency</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">dependency_type</span><span class="p">,</span><span class="w"> </span><span class="n">load_dependencies</span>
<span class="w">  </span><span class="k">implicit none</span>

<span class="k">  type</span><span class="p">(</span><span class="n">dependency_type</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">deps</span><span class="p">(:)</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arg</span>

<span class="w">  </span><span class="k">call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span>

<span class="w">  </span><span class="k">block</span>
<span class="k">    type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_error</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">error</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">pointer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">child</span>

<span class="w">    </span><span class="k">call </span><span class="n">toml_load</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span><span class="w"> </span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">error</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">%</span><span class="n">message</span>
<span class="w">      </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dependencies&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">child</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">      call </span><span class="n">load_dependencies</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="k">end if</span>
<span class="k">  end block</span>
<span class="k">end program </span><span class="n">demo</span>
</pre></div>
</div>
</div>
<p>An example triggering the error is shown below.</p>
<div class="literal-block-wrapper docutils container" id="id15">
<div class="code-block-caption"><span class="caption-text">fpm.toml</span><a class="headerlink" href="#id15" title="Permalink to this code">#</a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[dependencies]</span>
<span class="n">json-fortran</span><span class="p">.</span><span class="n">git</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://github.com/jacobwilliams/json-fortran.git&quot;</span>
<span class="n">toml-f</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;^0.3.0&quot;</span>
</pre></div>
</div>
</div>
<p>Running this example will produce the following error showing lines 1 and 3 of our example input.</p>
<pre class="ansi-block highlight literal-block">error: All entries must be subtables
 --&gt; fpm.toml:3:1-6
  |
1 | [dependencies]
  |  ------------ required for this table
  :
3 | toml-f = &quot;^0.3.0&quot;
  | ^^^^^^ must be a subtable
  |</pre>
<p>Now we want to implement the actual conflicting case described above.
Here we just read the two strings from the <em>git</em> and <em>path</em> entry.
Note that the <em>get_value</em> interface will not allocate the string if no value is present, which allows to conveniently check for success via allocation status of the strings.</p>
<div class="literal-block-wrapper docutils container" id="id16">
<div class="code-block-caption"><span class="caption-text">src/dependency.f90</span><a class="headerlink" href="#id16" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="c">!&gt; Load a single dependency from a table</span>
<span class="w">  </span><span class="k">subroutine </span><span class="n">load_dependency</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="c">!&gt; Information about the dependency</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">dependency_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dependency</span>
<span class="w">    </span><span class="c">!&gt; Name of the dependency</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_key</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">name</span>
<span class="w">    </span><span class="c">!&gt; TOML data structure</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="c">!&gt; Context for error messages</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">git_origin</span><span class="p">,</span><span class="w"> </span><span class="n">path_origin</span>
<span class="w">    </span><span class="kt">character</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">git</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_key</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">list</span><span class="p">(:)</span>

<span class="w">    </span><span class="n">dependency</span><span class="p">%</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">%</span><span class="n">key</span>

<span class="w">    </span><span class="k">call </span><span class="n">table</span><span class="p">%</span><span class="n">get_keys</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>

<span class="w">    </span><span class="k">call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;git&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">git</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">git_origin</span><span class="p">)</span>
<span class="w">    </span><span class="k">call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">path_origin</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">git</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">allocated</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">git_origin</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">path_origin</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">        print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Remote dependency cannot have local path&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="n">path_origin</span><span class="p">,</span><span class="w"> </span><span class="n">git_origin</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="s2">&quot;cannot have local path&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;remote dependency already defined&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="k">else</span>
<span class="k">        print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Local dependency cannot have remote repository&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="n">git_origin</span><span class="p">,</span><span class="w"> </span><span class="n">path_origin</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="s2">&quot;cannot have remote repository&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;local dependency already defined&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="k">end if</span>
<span class="k">      stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>
<span class="k">  end subroutine </span><span class="n">load_dependency</span>
</pre></div>
</div>
</div>
<p>To preserve the order from the input we can compare the <em>origin</em> values of the two retrieved strings and produce the appropriate error message.</p>
<p>In this example, the <em>git</em> entry was defined first and a conflicting <em>path</em> entry is provided afterward.</p>
<div class="literal-block-wrapper docutils container" id="id17">
<div class="code-block-caption"><span class="caption-text">fpm.toml</span><a class="headerlink" href="#id17" title="Permalink to this code">#</a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[dependencies]</span>
<span class="n">toml-f</span><span class="p">.</span><span class="n">git</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://github.com/toml-f/toml-f.git&quot;</span>
<span class="n">toml-f</span><span class="p">.</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./subprojects/toml-f&quot;</span>
</pre></div>
</div>
</div>
<p>The order is reported correctly in the produced error message shown below.</p>
<pre class="ansi-block highlight literal-block">error: Remote dependency cannot have local path
 --&gt; fpm.toml:3:15-36
  |
2 | toml-f.git = &quot;https://github.com/toml-f/toml-f.git&quot;
  |              -------------------------------------- remote dependency already defined
3 | toml-f.path = &quot;./subprojects/toml-f&quot;
  |               ^^^^^^^^^^^^^^^^^^^^^^ cannot have local path
  |</pre>
<p>The other way round is also possible as shown in this example.</p>
<div class="literal-block-wrapper docutils container" id="id18">
<div class="code-block-caption"><span class="caption-text">fpm.toml</span><a class="headerlink" href="#id18" title="Permalink to this code">#</a></div>
<div class="highlight-toml notranslate"><div class="highlight"><pre><span></span><span class="k">[dependencies]</span>
<span class="n">toml-f</span><span class="p">.</span><span class="n">path</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;./subprojects/toml-f&quot;</span>
<span class="n">toml-f</span><span class="p">.</span><span class="n">git</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="s2">&quot;https://github.com/toml-f/toml-f.git&quot;</span>
</pre></div>
</div>
</div>
<p>The error message is adjusted accordingly and now reports a conflicting <em>git</em> entry to the already defined <em>path</em> entry.</p>
<pre class="ansi-block highlight literal-block">error: Local dependency cannot have remote repository
 --&gt; fpm.toml:3:14-51
  |
2 | toml-f.path = &quot;./subprojects/toml-f&quot;
  |               ---------------------- local dependency already defined
3 | toml-f.git = &quot;https://github.com/toml-f/toml-f.git&quot;
  |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ cannot have remote repository
  |</pre>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
<span class="sd-summary-text">full source</span><span class="sd-summary-state-marker sd-summary-chevron-right"><svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-right" viewBox="0 0 24 24" aria-hidden="true"><path d="M8.72 18.78a.75.75 0 0 1 0-1.06L14.44 12 8.72 6.28a.751.751 0 0 1 .018-1.042.751.751 0 0 1 1.042-.018l6.25 6.25a.75.75 0 0 1 0 1.06l-6.25 6.25a.75.75 0 0 1-1.06 0Z"></path></svg></span></summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The full <em>demo_dependency</em> module is given provided below.</p>
<div class="literal-block-wrapper docutils container" id="id19">
<div class="code-block-caption"><span class="caption-text">src/dependency.f90</span><a class="headerlink" href="#id19" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="c">!&gt; Demo module for fpm-like dependency reading</span>
<span class="k">module </span><span class="n">demo_dependency</span>
<span class="w">  </span><span class="k">use </span><span class="n">tomlf</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">toml_table</span><span class="p">,</span><span class="w"> </span><span class="n">toml_context</span><span class="p">,</span><span class="w"> </span><span class="n">toml_key</span><span class="p">,</span><span class="w"> </span><span class="n">get_value</span>
<span class="w">  </span><span class="k">implicit none</span>

<span class="w">  </span><span class="c">!&gt; Dummy dependency type storing only the name of the dependency</span>
<span class="w">  </span><span class="k">type</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dependency_type</span>
<span class="w">    </span><span class="c">!&gt; The name of the dependency</span>
<span class="w">    </span><span class="kt">character</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">name</span>
<span class="w">  </span><span class="k">end type </span><span class="n">dependency_type</span>

<span class="k">contains</span>

<span class="w">  </span><span class="c">!&gt; Load a list of dependencies from a table</span>
<span class="w">  </span><span class="k">subroutine </span><span class="n">load_dependencies</span><span class="p">(</span><span class="n">dependencies</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="c">!&gt; List of dependencies</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">dependency_type</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="p">,</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dependencies</span><span class="p">(:)</span>
<span class="w">    </span><span class="c">!&gt; TOML data structure</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="c">!&gt; Context for error messages</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">it</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_key</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">list</span><span class="p">(:)</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">pointer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">child</span>

<span class="w">    </span><span class="k">call </span><span class="n">table</span><span class="p">%</span><span class="n">get_keys</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="w">    </span><span class="k">allocate</span><span class="p">(</span><span class="n">dependencies</span><span class="p">(</span><span class="n">size</span><span class="p">(</span><span class="n">list</span><span class="p">)))</span>

<span class="w">    </span><span class="k">do </span><span class="n">it</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">size</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>
<span class="w">      </span><span class="k">call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">it</span><span class="p">),</span><span class="w"> </span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">origin</span><span class="p">)</span>
<span class="w">      </span><span class="k">if</span><span class="w"> </span><span class="p">(.</span><span class="nb">not</span><span class="p">.</span><span class="nb">associated</span><span class="p">(</span><span class="n">child</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">        print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;All entries must be subtables&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">%</span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;must be a subtable&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;required for this table&quot;</span><span class="p">)</span>
<span class="w">        </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">      </span><span class="k">end if</span>
<span class="k">      call </span><span class="n">load_dependency</span><span class="p">(</span><span class="n">dependencies</span><span class="p">(</span><span class="n">it</span><span class="p">),</span><span class="w"> </span><span class="n">list</span><span class="p">(</span><span class="n">it</span><span class="p">),</span><span class="w"> </span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="k">end do</span>
<span class="k">  end subroutine </span><span class="n">load_dependencies</span>

<span class="w">  </span><span class="c">!&gt; Load a single dependency from a table</span>
<span class="w">  </span><span class="k">subroutine </span><span class="n">load_dependency</span><span class="p">(</span><span class="n">dependency</span><span class="p">,</span><span class="w"> </span><span class="n">name</span><span class="p">,</span><span class="w"> </span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="c">!&gt; Information about the dependency</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">dependency_type</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">out</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">dependency</span>
<span class="w">    </span><span class="c">!&gt; Name of the dependency</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_key</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">name</span>
<span class="w">    </span><span class="c">!&gt; TOML data structure</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">inout</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="c">!&gt; Context for error messages</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">),</span><span class="w"> </span><span class="k">intent</span><span class="p">(</span><span class="n">in</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="kt">integer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">git_origin</span><span class="p">,</span><span class="w"> </span><span class="n">path_origin</span>
<span class="w">    </span><span class="kt">character</span><span class="p">(:),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">git</span><span class="p">,</span><span class="w"> </span><span class="n">path</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_key</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">list</span><span class="p">(:)</span>

<span class="w">    </span><span class="n">dependency</span><span class="p">%</span><span class="n">name</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">name</span><span class="p">%</span><span class="n">key</span>

<span class="w">    </span><span class="k">call </span><span class="n">table</span><span class="p">%</span><span class="n">get_keys</span><span class="p">(</span><span class="n">list</span><span class="p">)</span>

<span class="w">    </span><span class="k">call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;git&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">git</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">git_origin</span><span class="p">)</span>
<span class="w">    </span><span class="k">call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;path&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">path</span><span class="p">,</span><span class="w"> </span><span class="n">origin</span><span class="o">=</span><span class="n">path_origin</span><span class="p">)</span>

<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">git</span><span class="p">)</span><span class="w"> </span><span class="p">.</span><span class="nb">and</span><span class="p">.</span><span class="w"> </span><span class="nb">allocated</span><span class="p">(</span><span class="n">path</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">      if</span><span class="w"> </span><span class="p">(</span><span class="n">git_origin</span><span class="w"> </span><span class="o">&lt;</span><span class="w"> </span><span class="n">path_origin</span><span class="p">)</span><span class="w"> </span><span class="k">then</span>
<span class="k">        print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Remote dependency cannot have local path&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="n">path_origin</span><span class="p">,</span><span class="w"> </span><span class="n">git_origin</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="s2">&quot;cannot have local path&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;remote dependency already defined&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="k">else</span>
<span class="k">        print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Local dependency cannot have remote repository&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="n">git_origin</span><span class="p">,</span><span class="w"> </span><span class="n">path_origin</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">          </span><span class="p">&amp;</span><span class="w"> </span><span class="s2">&quot;cannot have remote repository&quot;</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;local dependency already defined&quot;</span><span class="p">)</span>
<span class="w">      </span><span class="k">end if</span>
<span class="k">      stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>
<span class="k">  end subroutine </span><span class="n">load_dependency</span>

<span class="k">end module </span><span class="n">demo_dependency</span>
</pre></div>
</div>
</div>
<p class="sd-card-text">The driver for the examples is given here.</p>
<div class="literal-block-wrapper docutils container" id="id20">
<div class="code-block-caption"><span class="caption-text">app/main.f90</span><a class="headerlink" href="#id20" title="Permalink to this code">#</a></div>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">program </span><span class="n">demo</span>
<span class="w">  </span><span class="k">use </span><span class="n">tomlf</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">toml_table</span><span class="p">,</span><span class="w"> </span><span class="n">toml_error</span><span class="p">,</span><span class="w"> </span><span class="n">toml_context</span><span class="p">,</span><span class="w"> </span><span class="n">toml_load</span><span class="p">,</span><span class="w"> </span><span class="n">get_value</span>
<span class="w">  </span><span class="k">use </span><span class="n">demo_dependency</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">dependency_type</span><span class="p">,</span><span class="w"> </span><span class="n">load_dependencies</span>
<span class="w">  </span><span class="k">implicit none</span>

<span class="k">  type</span><span class="p">(</span><span class="n">dependency_type</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">deps</span><span class="p">(:)</span>
<span class="w">  </span><span class="kt">character</span><span class="p">(</span><span class="mi">128</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">arg</span>

<span class="w">  </span><span class="k">call </span><span class="nb">get_command_argument</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="n">arg</span><span class="p">)</span>

<span class="w">  </span><span class="k">block</span>
<span class="k">    type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">table</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_error</span><span class="p">),</span><span class="w"> </span><span class="k">allocatable</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">error</span>
<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_context</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">context</span>

<span class="w">    </span><span class="k">type</span><span class="p">(</span><span class="n">toml_table</span><span class="p">),</span><span class="w"> </span><span class="k">pointer</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">child</span>

<span class="w">    </span><span class="k">call </span><span class="n">toml_load</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="nb">trim</span><span class="p">(</span><span class="n">arg</span><span class="p">),</span><span class="w"> </span><span class="n">context</span><span class="o">=</span><span class="n">context</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">allocated</span><span class="p">(</span><span class="n">error</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">      print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">error</span><span class="p">%</span><span class="n">message</span>
<span class="w">      </span><span class="k">stop </span><span class="mi">1</span>
<span class="w">    </span><span class="k">end if</span>

<span class="k">    call </span><span class="n">get_value</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;dependencies&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="p">)</span>
<span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="p">(</span><span class="nb">associated</span><span class="p">(</span><span class="n">child</span><span class="p">))</span><span class="w"> </span><span class="k">then</span>
<span class="k">      call </span><span class="n">load_dependencies</span><span class="p">(</span><span class="n">deps</span><span class="p">,</span><span class="w"> </span><span class="n">child</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">)</span>
<span class="w">    </span><span class="k">end if</span>
<span class="k">  end block</span>
<span class="k">end program </span><span class="n">demo</span>
</pre></div>
</div>
</div>
</div>
</details></section>
<section id="color-support">
<h2>Color support<a class="headerlink" href="#color-support" title="Permalink to this heading">#</a></h2>
<p>All reports also support colorful terminal output.
For this purpose, we can use the provided <em>toml_terminal</em> which can be instantiated with color support.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">block</span>
<span class="k">  use </span><span class="n">tomlf</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">toml_terminal</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">toml_terminal</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terminal</span>
<span class="w">  </span><span class="n">terminal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toml_terminal</span><span class="p">(.</span><span class="n">true</span><span class="p">.)</span>
<span class="k">end block</span>
</pre></div>
</div>
<p>To activate the color support for error messages produced in the load interface the optional argument <em>config</em> takes a <em>toml_parser_config</em> instance.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">call </span><span class="n">toml_load</span><span class="p">(</span><span class="n">table</span><span class="p">,</span><span class="w"> </span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="n">config</span><span class="o">=</span><span class="n">toml_parser_config</span><span class="p">(</span><span class="n">color</span><span class="o">=</span><span class="p">.</span><span class="n">true</span><span class="p">.),</span><span class="w"> </span><span class="n">error</span><span class="o">=</span><span class="n">error</span><span class="p">)</span>
</pre></div>
</div>
<p>Alternatively, an instance of a <em>toml_terminal</em> can be passed to the <em>toml_parser_config</em> constructor.</p>
<p>For working with the <em>context</em> instance returned by the load interface we need a terminal to activate the colorful output passed to the optional <em>color</em> argument.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="n">context</span><span class="p">%</span><span class="n">report</span><span class="p">(</span><span class="s2">&quot;Cannot read timestep&quot;</span><span class="p">,</span><span class="w"> </span><span class="p">&amp;</span>
<span class="w">  </span><span class="p">&amp;</span><span class="w"> </span><span class="n">origin</span><span class="p">,</span><span class="w"> </span><span class="s2">&quot;expected real value&quot;</span><span class="p">,</span><span class="w"> </span><span class="n">color</span><span class="o">=</span><span class="n">toml_terminal</span><span class="p">(.</span><span class="n">true</span><span class="p">.))</span>
</pre></div>
</div>
<p>The <em>terminal</em> can also be used to colorize regular text output.</p>
<div class="highlight-fortran notranslate"><div class="highlight"><pre><span></span><span class="k">block</span>
<span class="k">  use </span><span class="n">tomlf_terminal</span><span class="p">,</span><span class="w"> </span><span class="k">only</span><span class="w"> </span><span class="p">:</span><span class="w"> </span><span class="n">toml_terminal</span><span class="p">,</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">//</span><span class="p">),</span><span class="w"> </span><span class="n">operator</span><span class="p">(</span><span class="o">+</span><span class="p">)</span>
<span class="w">  </span><span class="k">type</span><span class="p">(</span><span class="n">toml_terminal</span><span class="p">)</span><span class="w"> </span><span class="kd">::</span><span class="w"> </span><span class="n">terminal</span>
<span class="w">  </span><span class="n">terminal</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">toml_terminal</span><span class="p">(.</span><span class="n">true</span><span class="p">.)</span>
<span class="w">  </span><span class="k">print</span><span class="w"> </span><span class="s1">&#39;(a)&#39;</span><span class="p">,</span><span class="w"> </span><span class="p">(</span><span class="n">terminal</span><span class="p">%</span><span class="n">fg_red</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">terminal</span><span class="p">%</span><span class="n">bold</span><span class="p">)</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="s2">&quot;red bold text&quot;</span><span class="w"> </span><span class="o">//</span><span class="w"> </span><span class="n">terminal</span><span class="p">%</span><span class="n">reset</span>
<span class="k">end block</span>
</pre></div>
</div>
<p>If the terminal is not initialized or the color support is explicitly disabled by passing <code class="docutils literal notranslate"><span class="pre">.false.</span></code> to the constructor, the output will be plain text.</p>
</section>
</section>

<div class="section ablog__blog_comments">
   
</div>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
    <a class="left-prev"
       href="array.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Working with arrays</p>
      </div>
    </a>
    <a class="right-next"
       href="datetime.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Date time compatibility</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#loading-with-rich-context">Loading with rich context</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#multiline-reports">Multiline reports</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#color-support">Color support</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sebastian Ehlert
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2019-2025, Sebastian Ehlert.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>